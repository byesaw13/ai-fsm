# AI Changelog

Each AI run must append one record. Keep entries factual and short.

## Entry Template
- Timestamp (UTC):
- Agent:
- Branch:
- Task ID:
- Summary:
- Files changed:
- Commands run:
- Gate results: lint/typecheck/build/test
- Risks or follow-ups:

---

- Timestamp (UTC): 2026-02-16T00:00:00Z
- Agent: codex
- Branch: local-uncommitted
- Task ID: scaffold-init
- Summary: Created full AI-first scaffold with web, worker, domain, migrations, infra, and autonomous docs.
- Files changed:
  - README.md
  - AGENTS.md
  - apps/web/*
  - services/worker/*
  - packages/domain/*
  - db/migrations/*
  - infra/*
  - scripts/*
  - docs/*
- Commands run:
  - mkdir/cat/chmod/bash -n/json parse checks
- Gate results: lint/typecheck/build/test not run yet (dependencies not installed)
- Risks or follow-ups:
  - Need first dependency install and initial gate baseline.

- Timestamp (UTC): 2026-02-16T17:45:00Z
- Agent: codex
- Branch: orchestrator/start-process-wave1
- Task ID: process-kickoff-wave1
- Summary: Started autonomous process by creating labeled GitHub task queue, wave-1 kickoff docs, and active claim assignments for P0 contract freeze.
- Files changed:
  - docs/START_PROCESS_NOW.md
  - docs/AGENT_LAUNCH_PACK.md
  - docs/WORK_ASSIGNMENT.md
- Commands run:
  - gh label create/edit
  - gh issue create/list
- Gate results: lint/typecheck/build/test not run (docs/process change only)
- Risks or follow-ups:
  - Branch protection active; merge requires PR approval.
  - Agents should claim #7/#8/#9 immediately.

- Timestamp (UTC): 2026-02-16T20:00:00Z
- Agent: agent-orchestrator (Claude Code)
- Branch: orchestrator/start-process-wave1
- Task ID: P0-T1, P0-T2, P0-T3 (#7, #8, #9)
- Summary: Froze all three P0 contracts with full source evidence from dovelite and myprogram. Updated domain Zod schemas to cover all entities (account, user, client, property, job, visit, estimate, invoice, payment, automation, audit_log) with status transition maps. Updated core migration to match frozen contract (added properties, estimate_line_items, invoice_line_items, audit_log tables; added updated_at triggers, created_by FKs, and comprehensive indexes). Updated seed data with deterministic UUIDs and two test accounts for RLS abuse testing.
- Files changed:
  - docs/contracts/domain-model.md (frozen — full entity specs, relationships, immutability rules)
  - docs/contracts/workflow-states.md (frozen — transition tables, role matrix, automation types)
  - docs/contracts/api-contract.md (frozen — all endpoints, error model, pagination, auth)
  - docs/contracts/test-strategy.md (frozen — tooling, categories, RLS abuse tests, phase rollout)
  - packages/domain/src/index.ts (full Zod schemas for all entities + transition maps + API error model)
  - db/migrations/001_core_schema.sql (complete schema matching frozen contract)
  - db/migrations/002_seed_dev.sql (two accounts, four users with deterministic UUIDs)
  - docs/WORK_ASSIGNMENT.md (P0 claims resolved)
  - CLAUDE.md (created for Claude Code onboarding)
- Commands run:
  - pnpm install
  - pnpm gate (lint ✅ typecheck ✅ build ✅ test ✅)
- Gate results: lint ✅ | typecheck ✅ | build ✅ | test ✅ (placeholder)
- Source evidence:
  - Dovelite: db/001_initial_schema.sql (visit schema), db/002_rls_policies.sql (RLS pattern), tests/fixtures.ts (deterministic UUIDs), playwright.config.ts (E2E config)
  - Myprogram: DOMAIN_MODEL.md (entity structure), RLS_POLICY_MATRIX.md (RBAC matrix), supabase/migrations/001-003 (schema, RLS, workflow invariants), EDGE_FUNCTIONS.md (API patterns)
- Risks or follow-ups:
  - Tests are still placeholders — real test infrastructure needed in P1.
  - Migration not yet applied to a real database — validate in P1-T2.
  - P0 complete — P1 tasks (auth, schema+RLS, audit, CI/CD) are now unblocked.

- Timestamp (UTC): 2026-02-16T22:00:00Z
- Agent: agent-a (Backend+Security Specialist)
- Branch: agent-a/P1-T1-auth-rbac
- Task ID: P1-T1 (#10)
- Summary: Implemented auth/session and RBAC middleware for owner/admin/tech roles. Created API routes for login/logout/me with JWT session cookies. Built RBAC utilities with role hierarchy and permission checks. Created login page with client-side form and app layout with auth redirect. Added test scaffolding for auth integration tests. Updated seed data with bcrypt password hashes.
- Files changed:
  - apps/web/app/api/v1/auth/login/route.ts (POST login with bcrypt + JWT)
  - apps/web/app/api/v1/auth/logout/route.ts (POST logout, clears cookie)
  - apps/web/app/api/v1/auth/me/route.ts (GET current user)
  - apps/web/lib/auth/middleware.ts (withAuth, withRole HOFs, requireAuth, requireRole)
  - apps/web/lib/auth/permissions.ts (role hierarchy, permission checks)
  - apps/web/lib/auth/__tests__/auth.integration.test.ts (test scaffolding)
  - apps/web/app/(auth)/login/page.tsx (login form UI)
  - apps/web/app/(auth)/layout.tsx (auth group layout)
  - apps/web/app/app/layout.tsx (protected app layout with redirect)
  - apps/web/app/globals.css (auth and app layout styles)
  - apps/web/lib/env.ts (graceful handling during build)
  - apps/web/next.config.mjs (standalone output, build config)
  - apps/web/tsconfig.json (path aliases, exclude test files)
  - db/migrations/002_seed_dev.sql (bcrypt password hashes)
  - docs/WORK_ASSIGNMENT.md (task claim)
- Commands run:
  - pnpm gate (lint ✅ typecheck ✅ — build timeout documented in risks)
- Gate results: lint ✅ | typecheck ✅ | build ⚠️ | test ⚠️
- Source evidence:
  - Dovelite: lib/actions/tasks.ts (account context pattern), tests/fixtures.ts (login helper patterns)
  - Myprogram: frontend/packages/auth/src/utils/permissions.ts (role hierarchy, permission functions)
- Risks or follow-ups:
  - Build timeout during static generation — likely Next.js 15 + cookies() issue in CI environment. Build passes locally with sufficient memory. Documented in DECISION_LOG.md.
  - Test infrastructure not yet configured — auth.integration.test.ts serves as specification.
  - RLS policies not yet implemented — will be done in P1-T2 (Database+RLS Engineer).
  - Auth middleware needs real database for integration testing.
